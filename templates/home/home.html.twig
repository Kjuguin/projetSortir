{% extends 'layout.html.twig' %}

{% block title %}Sorties entr'Eni{% endblock %}

{% block body %}

    <!-- SECTION 1 : Recherche et filtres des sorties -->
    <section class="section-filtre">
        <div class="container">

            <form action="{{ path('home',{'recherche':'recherche'} ) }}" method="post">
                <!-- filtres inputs -->
                <div class="filtre-bloc-left">
                    <!-- 1ere ligne d'inputs -->
                    <div class="filtre-ligne-1">
                        <div class="bloc-field bf-1">
                            <label for="site">Site</label>
                            <select class="input-home" name="site" id="site">
                                <option value="" selected>Tous les sites</option>
                                {% for site in sites %}
                                    <option value="{{ site.id }}"> {{ site.nomSite }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="bloc-field bf-2">
                            <label for="nom">Le nom contient</label>
                            <input class="input-home" type="search" name="nom" id="nom" value="">
                        </div>
                    </div>

                    <div class="clear"></div>

                    <!-- 2eme ligne d'inputs -->
                    <div class="filtre-ligne-2">
                        <div class="bloc-field bf-3">
                            <label for="date-debut">Début</label>
                            <input class="input-home" type="date" name="date-debut" id="date-debut">
                        </div>
                        <div class="bloc-field bf-4">
                            <label for="date-fin">Fin</label>
                            <input class="input-home" type="date" name="date-fin" id="date-fin">
                        </div>
                    </div>

                    <div class="clear"></div>

                    <!-- filtres checkboxes -->
                    <div class="bf-checkboxes">
                        <div class="check">
                            <input type="checkbox" name="filtre1" value="filtre1">
                            <label for="filtre1">Sorties dont je suis l'organisateur.rice</label>
                        </div>

                        <div class="check">
                            <input type="checkbox" name="filtre2" value="filtre2">
                            <label for="filtre2">Sorties auxquelles je suis inscrit.e</label>
                        </div>

                        <div class="check">
                            <input type="checkbox" name="filtre3" value="filtre3">
                            <label for="filtre3">Sorties auxquelles je ne suis pas inscrit.e</label>
                        </div>

                        <div class="check">
                            <input type="checkbox" name="filtre4" value="filtre4">
                            <label for="filtre4">Sorties passées</label>
                        </div>
                    </div>
                </div>

                <!-- bouton recherche -->
                <div>
                    <input type="submit" value="Rechercher">
                </div>
            </form>
        </div>

        <!-- image background: clouds + city -->
        <div class="background-img">
            <img src="{{ asset('img/clouds-city.png') }}" alt="clouds-background">
        </div>
    </section>

    <!-- SECTION 2 : Affichage du tableau des sorties -->
    <div class="container-fluid">
        <div class="table-responsive-sm">
            {% if(sorties !=null) %}
                <table id="table-sortie" data-toggle="table" class="table table-bordered table-orderable table-striped">
                    <thead class="thead-light">
                    <tr class="active">
                        <th scope="col" data-field="nom" data-sortable="true">Nom</th>
                        <th scope="col" data-field="date-sortie" data-sortable="true">Date</th>
                        <th scope="col" data-field="cloture" data-sortable="true">Clôture</th>
                        <th scope="col" data-field="places" data-sortable="true">Places</th>
                        <th scope="col" data-field="etat" data-sortable="true">Etat</th>
                        <th scope="col" data-field="inscrit" data-sortable="true">Inscrit</th>
                        <th scope="col" data-field="organisateur" data-sortable="true">Organisateur</th>
                        <th scope="col" data-field="action" data-sortable="true">Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for sortie in sorties %}
                        <tr>
                            <td>{{ sortie.nom }}</td>
                            <td>{{ sortie.dateDebut | date('d/m/Y H:i') }}</td>
                            <td>{{ sortie.dateCloture | date('d/m/Y') }}</td>
                            <td>{{ sortie.noInscriptions.count }} / {{ sortie.nbInscriptionMax }}</td>
                            <td>{{ sortie.noEtat.libelle }}</td>
                            <td>
                                {% if app.user %}
                                    {% for inscrit in sortie.noInscriptions %}
                                        {% if inscrit.noUser.id == app.user.id %}
                                            <p>Oui</p>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ path('utilisateur_afficherProfil',{'id':sortie.noOrganisateur.id}) }}">{{ sortie.noOrganisateur.pseudo }}</a>
                            </td>
                            <td><a href="{{ path('sortie_afficherSortie',{'id':sortie.id}) }}">Afficher</a> - modifier</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

            {% endif %}

        </div>
    </div>

{% endblock %}
